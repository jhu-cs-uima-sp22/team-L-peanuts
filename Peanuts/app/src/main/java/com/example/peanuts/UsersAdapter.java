package com.example.peanuts;import android.content.Context;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ArrayAdapter;import android.widget.CheckBox;import android.widget.CompoundButton;import android.widget.LinearLayout;import android.widget.TextView;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import java.util.ArrayList;import java.util.List;import java.util.UUID;public class UsersAdapter extends ArrayAdapter<NewAccount.User> {    int resource;    protected String groupId;    private DatabaseReference myRef;    private FirebaseDatabase database;    public UsersAdapter(Context ctx, int res, List<NewAccount.User> users, String uuid) {        super(ctx, res, users);        resource = res;        this.groupId = uuid;    }    @Override    public View getView(int position, View convertView, ViewGroup parent) {        LinearLayout usersView;        NewAccount.User it = getItem(position);        database = FirebaseDatabase.getInstance("https://peanuts-e9a7c-default-rtdb.firebaseio.com/");        myRef = database.getReference("groups");        if (convertView == null) {            usersView = new LinearLayout(getContext());            String inflater = android.content.Context.LAYOUT_INFLATER_SERVICE;            LayoutInflater vi = (LayoutInflater) getContext().getSystemService(inflater);            vi.inflate(resource, usersView, true);        } else {            usersView = (LinearLayout) convertView;        }        TextView userName = usersView.findViewById(R.id.user_name);        TextView userEmail = userName.findViewById(R.id.user_email);        CheckBox checkBox = userName.findViewById(R.id.user_checkbox);        userName.setText(it.getName());        userEmail.setText(it.getEmail());        List<NewAccount.User> members = new ArrayList<>();        List<String> restrictions = new ArrayList<>();        checkBox.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {            @Override            public void onCheckedChanged(CompoundButton compoundButton, boolean b) {                Log.d("ITEM", "added");                if (b) {                    members.add(it);                    for (String item : it.getRestrictions()) {                        if (!restrictions.contains(item)) {                            restrictions.add(item);                        }                    }                } else if (members.contains(it)) {                    members.remove(it);                }                myRef.child(groupId).child("members").setValue(members);                myRef.child(groupId).child("restrictions").setValue(restrictions);            }        });        return usersView;        }    }